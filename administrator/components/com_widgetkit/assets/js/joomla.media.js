!function(e){function t(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}angular.module("widgetkit").service("mediaPicker",["$templateCache","$compile","$q","$rootScope","filterFilter","UIkit","mediaRequest","Application",function(i,n,o,r,l,a,d,s){var c,p,u,f,m,g,h={init:function(l){return this.options=angular.extend({multiple:!1},l),m=o.defer(),p=e(i.get("media")),u=p.data("media-path"),f=n(p)(r).scope(),f.vm=this,f.selectItem=function(i,n){if(n.shiftKey&&g){t();for(var o,r=e(n.target).closest("li"),l=r.parent().children(),a=r.index()>g.index()?1:-1,d=1===a?g.index():r.index(),s=1===a?r.index():g.index(),c=d;s>=c;c++)o=l.eq(c).scope(),o[o.folder?"folder":"file"].selected=!0}else i.selected=!i.selected;g=e(n.target).closest("li")},this.open("").then(function(){if(window.widgetkit.env.modal){var t=window.widgetkit.env.modal.element.children(":first").hide();h.close=function(){t.show(),p.remove()},t.parent().append(p)}else h.modal=e.UIkit.modal(e('<div class="uk-modal">').append(p).appendTo("body")).show(),h.close=function(){h.modal.hide()},e.UIkit.domObserve(h.modal.element);h.initUpload()}),m.promise},initUpload:function(){var t=e("#wk-upload-progressbar"),i=t.find(".uk-progress-bar"),n={param:"Filedata[]",params:{"Content-Type":"multipart/form-data"},allow:"*.(jpeg|jpg|gif|png|svg|mp3|ogg|wav|mp4|ogv|webm)",before:function(e){e.action=d.url({task:"file.upload",tmpl:"component",format:"html",folder:c},!0)},loadstart:function(){i.css("width","0%").text("0%"),t.removeClass("uk-hidden")},progress:function(e){e=Math.ceil(e)+"%",i.css("width",e).text(e)},allcomplete:function(n){i.css("width","100%").text("100%"),e(n).find(".alert-error, .alert-info")[0]&&a.notify(e(n).find(".alert-error p, .alert-info p").html(),"danger"),setTimeout(function(){t.addClass("uk-hidden")},250),h.open(c)}};a.uploadSelect(e("#wk-upload-select"),n),a.uploadDrop(p,n)},open:function(t){return d.get({view:"mediaList",tmpl:"component",folder:t,layout:"details"}).success(function(i){g=null,f.media=[],f.breadcrumbs=[];var n=e(i).find("tbody tr");".."==n.first().find(".description").text().trim()&&(n=n.not(n[0])),n.each(function(){var i=e(this),n=i.find("td:first a"),o=i.find("td :checkbox").val(),r=i.find("td.dimensions").text().trim().split(" x "),l=(t?t+"/":"")+o;f.media.push({title:o,path:l,url:(u?u+"/":"")+l,href:s.baseUrl()+"/"+(u?u+"/":"")+l,type:n.is("[target]")?"folder":"file",image:Boolean(l.match(/\.(jpe?g|png|gif|svg)$/)),width:r[0],height:r[1],size:i.find("td.filesize").text().trim()})}),c=t;var o=(c?"/"+c:"").split("/");do f.breadcrumbs.unshift({path:o.join("/").substr(1),title:o.pop()});while(o.length);f.breadcrumbs[0].title="home"})},select:function(){var e=h.getSelected();e.forEach(function(e){e.title=e.title.replace(/[_-]/g," ").replace(/\.[^\.]+$/,"").replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)})}),m.resolve(this.options.multiple||!e.length?e:e[0]),h.close()},addFolder:function(){var e=prompt("Folder Name");e&&d.post({task:"folder.create",foldername:e,folderbase:c}).success(function(){h.open(c)})},remove:function(){window.confirm("Are you sure?")&&d.post({task:"folder.delete",folder:c,rm:h.getSelected().map(function(e){return e.title})}).success(function(){h.open(c)})},getSelected:function(){return l(f.media,{selected:!0})}};return{select:function(e){return h.init(e)}}}]).service("mediaRequest",["$q","$http","Application",function(t,i,n){var o="index.php?option=com_media";return{get:function(e){return i.get(this.url(e))},post:function(t){return t[n.config.token]=1,i.post(o,e.param(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},url:function(t,i){return i&&(t[n.config.token]=1),o+"&"+e.param(t)}}}])}(jQuery);